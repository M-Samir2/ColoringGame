<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Coloring Game</title>

<style>
body{margin:0;background:#222;color:#fff;font-family:Arial;overflow:hidden}
#home,#editor{display:none;height:100vh}
#home{padding:10px}
h2{text-align:center}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px}
.grid img{width:100%;border-radius:10px;cursor:pointer}

#editor{display:flex;flex-direction:column}
#top{display:flex;gap:5px;padding:5px;background:#111}
#top button{flex:1;padding:8px;border:none;border-radius:6px}

#canvasBox{
  flex:1;
  overflow:hidden;
  touch-action:none;
  background:#333;
}

canvas{
  background:#fff;
  transform-origin:0 0;
}

#tools{
  display:flex;
  align-items:center;
  padding:5px;
  gap:6px;
  background:#111;
}

.color{
  width:30px;height:30px;border-radius:50%;
  border:2px solid #555;cursor:pointer
}
.color.active{
  border:3px solid #fff;
  transform:translateY(-3px);
}

.tool{
  width:36px;height:36px;border-radius:6px;
  background:#333;color:#fff;border:none;
  font-size:18px
}

input[type=range]{width:80px}
</style>
</head>

<body>

<div id="home">
<h2>Ø§Ø®ØªØ± ØµÙˆØ±Ø©</h2>
<div class="grid" id="gallery"></div>
</div>

<div id="editor">
<div id="top">
<button onclick="backHome()">ğŸ </button>
<button onclick="undo()">â†©ï¸ Undo</button>
<button onclick="save()">ğŸ’¾ Ø­ÙØ¸</button>
</div>

<div id="canvasBox">
<canvas id="canvas"></canvas>
</div>

<div id="tools">
<button class="tool" onclick="setTool('brush')">ğŸ–Œï¸</button>
<button class="tool" onclick="setTool('bucket')">ğŸª£</button>
<button class="tool" onclick="setTool('eraser')">ğŸ§½</button>

<input type="range" min="1" max="50" value="10" id="size">

<button class="tool" onclick="enhance()">âœ¨</button>

<div id="colors"></div>
</div>
</div>

<script>
/* ====== DATA ====== */
const images=["images/1.png","images/2.png","images/3.png"];
const colors=["#000","#f00","#0f0","#00f","#ff0","#0ff","#f0f","#ffa500","#8a2be2","#964b00","#fff","#888"];
const sounds={
  color:new Audio("sounds/color.mp3"),
  paint:new Audio("sounds/paint.mp3"),
  finish:new Audio("sounds/finish.mp3")
};

/* ====== HOME ====== */
const gallery=document.getElementById("gallery");
images.forEach(src=>{
 let img=document.createElement("img");
 img.src=src;
 img.onclick=()=>openImage(src);
 gallery.appendChild(img);
});
document.getElementById("home").style.display="block";

/* ====== CANVAS ====== */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
let tool="brush",color="#000",drawing=false;
let undoStack=[];

/* ====== ZOOM ====== */
let scale=1,lastDist=0;

const box=document.getElementById("canvasBox");
box.addEventListener("touchmove",e=>{
 if(e.touches.length==2){
   let dx=e.touches[0].clientX-e.touches[1].clientX;
   let dy=e.touches[0].clientY-e.touches[1].clientY;
   let dist=Math.sqrt(dx*dx+dy*dy);
   if(lastDist){
     scale+= (dist-lastDist)/300;
     scale=Math.min(Math.max(scale,0.5),3);
     canvas.style.transform=`scale(${scale})`;
   }
   lastDist=dist;
 }
});
box.addEventListener("touchend",()=>lastDist=0);

/* ====== TOOLS ====== */
function setTool(t){tool=t}
document.getElementById("size").oninput=e=>ctx.lineWidth=e.target.value;

/* ====== COLORS ====== */
const colorsDiv=document.getElementById("colors");
colors.forEach(c=>{
 let d=document.createElement("div");
 d.className="color";
 d.style.background=c;
 d.onclick=()=>{
   document.querySelectorAll(".color").forEach(x=>x.classList.remove("active"));
   d.classList.add("active");
   color=c;
   sounds.color.play();
 };
 colorsDiv.appendChild(d);
});

/* ====== DRAW ====== */
function getPos(e){
 let r=canvas.getBoundingClientRect();
 return {
   x:(e.clientX-r.left)/scale,
   y:(e.clientY-r.top)/scale
 };
}

canvas.onmousedown=e=>{
 drawing=true;
 ctx.beginPath();
 let p=getPos(e);
 ctx.moveTo(p.x,p.y);
 saveUndo();
};

canvas.onmousemove=e=>{
 if(!drawing)return;
 let p=getPos(e);
 if(tool==="brush"){
   ctx.strokeStyle=color;
   ctx.lineCap="round";
   ctx.lineTo(p.x,p.y);
   ctx.stroke();
 }
 if(tool==="eraser"){
   ctx.clearRect(p.x-ctx.lineWidth/2,p.y-ctx.lineWidth/2,ctx.lineWidth,ctx.lineWidth);
 }
};

canvas.onmouseup=()=>drawing=false;

/* ====== BUCKET ====== */
canvas.onclick=e=>{
 if(tool!=="bucket")return;
 saveUndo();
 let p=getPos(e);
 floodFill(Math.floor(p.x),Math.floor(p.y));
};

function floodFill(x,y){
 let img=ctx.getImageData(0,0,canvas.width,canvas.height);
 let data=img.data;
 let idx=(y*canvas.width+x)*4;
 let target=data.slice(idx,idx+4);
 let fill=hexToRgba(color);

 if(match(target,fill))return;
 let stack=[[x,y]];

 while(stack.length){
  let [cx,cy]=stack.pop();
  if(cx<0||cy<0||cx>=canvas.width||cy>=canvas.height)continue;
  let i=(cy*canvas.width+cx)*4;
  if(match(data.slice(i,i+4),target)){
    data[i]=fill[0];data[i+1]=fill[1];
    data[i+2]=fill[2];data[i+3]=255;
    stack.push([cx+1,cy],[cx-1,cy],[cx,cy+1],[cx,cy-1]);
  }
 }
 ctx.putImageData(img,0,0);
}

function match(a,b){return a[0]==b[0]&&a[1]==b[1]&&a[2]==b[2]}
function hexToRgba(h){
 let c=parseInt(h.slice(1),16);
 return [(c>>16)&255,(c>>8)&255,c&255,255];
}

/* ====== ENHANCE ====== */
function enhance(){
 let img=ctx.getImageData(0,0,canvas.width,canvas.height);
 let d=img.data;
 for(let i=0;i<d.length;i+=4){
   if(d[i]<240||d[i+1]<240||d[i+2]<240){
     d[i]=0;d[i+1]=0;d[i+2]=0;
   }
 }
 ctx.putImageData(img,0,0);
 alert("ØªÙ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø­ÙˆØ§Ù");
}

/* ====== UNDO ====== */
function saveUndo(){
 undoStack.push(canvas.toDataURL());
 if(undoStack.length>20)undoStack.shift();
}
function undo(){
 if(!undoStack.length)return;
 let img=new Image();
 img.src=undoStack.pop();
 img.onload=()=>ctx.drawImage(img,0,0);
}

/* ====== SAVE ====== */
function save(){
 sounds.finish.play();
 let a=document.createElement("a");
 a.href=canvas.toDataURL();
 a.download="coloring.png";
 a.click();
}

/* ====== OPEN ====== */
function openImage(src){
 document.getElementById("home").style.display="none";
 document.getElementById("editor").style.display="flex";
 let img=new Image();
 img.src=src;
 img.onload=()=>{
   canvas.width=img.width;
   canvas.height=img.height;
   ctx.drawImage(img,0,0);
 };
}

function backHome(){
 if(confirm("Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ø¯ÙˆÙ† Ø­ÙØ¸ØŸ")){
   document.getElementById("editor").style.display="none";
   document.getElementById("home").style.display="block";
 }
}
</script>
</body>
</html>
