<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>لوحة تلوين</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial;
  background: #f2f2f2;
}

#toolbar {
  display: flex;
  gap: 6px;
  padding: 8px;
  background: #fff;
  border-bottom: 1px solid #ccc;
  flex-wrap: wrap;
}

button, input[type=color] {
  padding: 6px;
  font-size: 14px;
}

#canvasWrapper {
  position: relative;
  width: 100%;
  height: calc(100vh - 70px);
  background: #999;
  overflow: hidden;
}

canvas {
  background: white;
  display: block;
}
</style>
</head>

<body>

<div id="toolbar">
  <button onclick="setBrush()">فرشة</button>
  <button onclick="setEraser()">ممحاة</button>
  <button onclick="setBucket()">بوكت</button>
  <button onclick="clearCanvas()">لوحة فاضية</button>
  <input type="color" id="colorPicker" value="#ff0000">
</div>

<div id="canvasWrapper">
  <canvas id="c"></canvas>
</div>

<script>
let canvas;
let currentTool = "brush";

function initCanvas() {
  const wrapper = document.getElementById("canvasWrapper");

  canvas = new fabric.Canvas("c", {
    isDrawingMode: true,
    selection: false
  });

  canvas.setWidth(wrapper.clientWidth);
  canvas.setHeight(wrapper.clientHeight);

  canvas.backgroundColor = "white";
  canvas.renderAll();

  canvas.freeDrawingBrush.width = 6;
  canvas.freeDrawingBrush.color =
    document.getElementById("colorPicker").value;

  // Zoom بالاصابع
  canvas.on("mouse:wheel", function(opt) {
    let zoom = canvas.getZoom();
    zoom *= 0.999 ** opt.e.deltaY;
    zoom = Math.min(Math.max(zoom, 0.5), 4);
    canvas.zoomToPoint({ x: opt.e.offsetX, y: opt.e.offsetY }, zoom);
    opt.e.preventDefault();
    opt.e.stopPropagation();
  });

  // تغيير اللون
  document.getElementById("colorPicker").oninput = e => {
    if (canvas.freeDrawingBrush) {
      canvas.freeDrawingBrush.color = e.target.value;
    }
  };
}

function setBrush() {
  currentTool = "brush";
  canvas.isDrawingMode = true;
}

function setEraser() {
  currentTool = "eraser";
  canvas.isDrawingMode = false;

  canvas.on("mouse:down", function(opt) {
    if (currentTool !== "eraser") return;
    const obj = canvas.findTarget(opt.e);
    if (obj && obj !== canvas.backgroundImage) {
      canvas.remove(obj);
    }
  });
}

function setBucket() {
  currentTool = "bucket";
  canvas.isDrawingMode = false;

  canvas.on("mouse:down", function(opt) {
    if (currentTool !== "bucket") return;
    const obj = canvas.findTarget(opt.e);
    if (obj && obj.fill) {
      obj.set("fill", document.getElementById("colorPicker").value);
      canvas.renderAll();
    }
  });
}

function clearCanvas() {
  canvas.clear();
  canvas.backgroundColor = "white";
  canvas.renderAll();
}

// تحميل صورة
function loadImage(src) {
  fabric.Image.fromURL(src, img => {
    clearCanvas();
    img.scaleToWidth(canvas.width);
    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
  }, { crossOrigin: "anonymous" });
}

window.onload = initCanvas;
</script>

</body>
</html>
