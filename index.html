<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Coloring Game</title>

<style>
body{margin:0;background:#222;color:#fff;font-family:Arial}
.screen{display:none;height:100vh}
button{border:none;border-radius:6px;padding:10px}

h2{text-align:center}

/* ===== PROFILE ===== */
#profiles{padding:20px}
.profile{background:#333;padding:10px;margin:5px;border-radius:6px}

/* ===== HOME ===== */
#home{padding:10px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px}
.grid img{width:100%;border-radius:10px;cursor:pointer}

/* ===== EDITOR ===== */
#editor{display:flex;flex-direction:column}
#top{display:flex;gap:5px;background:#111;padding:5px}
#canvasBox{flex:1;overflow:hidden;touch-action:none;background:#333}
canvas{background:#fff;transform-origin:0 0}
#tools{display:flex;align-items:center;gap:6px;background:#111;padding:5px}

.color{width:30px;height:30px;border-radius:50%;border:2px solid #555}
.color.active{border:3px solid #fff;transform:translateY(-3px)}
.tool{width:36px;height:36px;background:#333;color:#fff}
</style>
</head>

<body>

<!-- ===== PROFILE SCREEN ===== -->
<div id="profiles" class="screen">
<h2>Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø±ÙˆÙØ§ÙŠÙ„</h2>
<div id="profileList"></div>
<input id="newProfile" placeholder="Ø§Ø³Ù… Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø¬Ø¯ÙŠØ¯">
<button onclick="createProfile()">â• Ø¥Ù†Ø´Ø§Ø¡</button>
</div>

<!-- ===== HOME SCREEN ===== -->
<div id="home" class="screen">
<h2 id="profileName"></h2>
<button onclick="openEditor()">ğŸ–Œï¸ Ù„ÙˆØ­Ø© ÙØ§Ø¶ÙŠØ©</button>
<input type="file" accept="image/*" onchange="uploadImage(this)">
<div class="grid" id="gallery"></div>
<button onclick="goProfiles()">ØªØºÙŠÙŠØ± Ø¨Ø±ÙˆÙØ§ÙŠÙ„</button>
</div>

<!-- ===== EDITOR SCREEN ===== -->
<div id="editor" class="screen">
<div id="top">
<button onclick="backHome()">ğŸ </button>
<button onclick="undo()">ğŸ”™</button>
<button onclick="save()">ğŸ’¾</button>
</div>

<div id="canvasBox">
<canvas id="canvas"></canvas>
</div>

<div id="tools">
<button class="tool" onclick="setTool('brush')">ğŸ–Œï¸</button>
<button class="tool" onclick="setTool('bucket')">ğŸª£</button>
<button class="tool" onclick="setTool('eraser')">ğŸ§½</button>
<input type="range" min="2" max="40" value="10" id="size">
<button class="tool" onclick="enhance()">âœ¨</button>
<div id="colors"></div>
</div>
</div>

<script>
/* ===== GLOBAL ===== */
const screens={
 profiles:document.getElementById("profiles"),
 home:document.getElementById("home"),
 editor:document.getElementById("editor")
};
function show(name){
 Object.values(screens).forEach(s=>s.style.display="none");
 screens[name].style.display="block";
}

/* ===== PROFILES ===== */
let currentProfile="";
function getProfiles(){return JSON.parse(localStorage.getItem("profiles")||"[]")}
function saveProfiles(p){localStorage.setItem("profiles",JSON.stringify(p))}

function loadProfiles(){
 let list=document.getElementById("profileList");
 list.innerHTML="";
 getProfiles().forEach(p=>{
   let d=document.createElement("div");
   d.className="profile";
   d.textContent=p;
   d.onclick=()=>selectProfile(p);
   list.appendChild(d);
 });
}
function createProfile(){
 let name=newProfile.value.trim();
 if(!name)return;
 let p=getProfiles();
 p.push(name);
 saveProfiles(p);
 localStorage.setItem("data_"+name,JSON.stringify({images:[],saved:[]}));
 loadProfiles();
}
function selectProfile(p){
 currentProfile=p;
 document.getElementById("profileName").textContent=p;
 loadHome();
 show("home");
}

/* ===== HOME ===== */
const baseImages=["images/1.png","images/2.png","images/3.png"];
function loadHome(){
 let data=JSON.parse(localStorage.getItem("data_"+currentProfile));
 let g=document.getElementById("gallery");
 g.innerHTML="";
 [...baseImages,...data.images].forEach(src=>{
  let img=document.createElement("img");
  img.src=src;
  img.onclick=()=>openImage(src);
  g.appendChild(img);
 });
}
function uploadImage(inp){
 let r=new FileReader();
 r.onload=e=>{
  let d=JSON.parse(localStorage.getItem("data_"+currentProfile));
  d.images.push(e.target.result);
  localStorage.setItem("data_"+currentProfile,JSON.stringify(d));
  loadHome();
 };
 r.readAsDataURL(inp.files[0]);
}
function goProfiles(){show("profiles")}

/* ===== EDITOR ===== */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
let tool="brush",color="#000",drawing=false,undoStack=[];
document.getElementById("size").oninput=e=>ctx.lineWidth=e.target.value;

/* COLORS */
const colors=["#000","#f00","#0f0","#00f","#ff0","#0ff","#f0f","#ffa500","#8a2be2","#964b00","#fff","#888"];
colors.forEach(c=>{
 let d=document.createElement("div");
 d.className="color";
 d.style.background=c;
 d.onclick=()=>{
  document.querySelectorAll(".color").forEach(x=>x.classList.remove("active"));
  d.classList.add("active");
  color=c;
 };
 colors.appendChild(d);
});

/* DRAW */
canvas.onmousedown=e=>{
 drawing=true;
 ctx.beginPath();
 ctx.moveTo(e.offsetX,e.offsetY);
 undoStack.push(canvas.toDataURL());
};
canvas.onmousemove=e=>{
 if(!drawing)return;
 if(tool==="brush"){
  ctx.strokeStyle=color;
  ctx.lineCap="round";
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
 }
 if(tool==="eraser"){
  ctx.clearRect(e.offsetX-10,e.offsetY-10,20,20);
 }
};
canvas.onmouseup=()=>drawing=false;
canvas.onclick=e=>{ if(tool==="bucket") flood(e.offsetX,e.offsetY); };

function flood(x,y){
 let img=ctx.getImageData(0,0,canvas.width,canvas.height);
 let d=img.data;
 let i=(y*canvas.width+x)*4;
 let t=d.slice(i,i+4);
 let f=hex(color);
 if(match(t,f))return;
 let s=[[x,y]];
 while(s.length){
  let [cx,cy]=s.pop();
  let ii=(cy*canvas.width+cx)*4;
  if(match(d.slice(ii,ii+4),t)){
   d[ii]=f[0];d[ii+1]=f[1];d[ii+2]=f[2];d[ii+3]=255;
   s.push([cx+1,cy],[cx-1,cy],[cx,cy+1],[cx,cy-1]);
  }
 }
 ctx.putImageData(img,0,0);
}
function hex(h){let c=parseInt(h.slice(1),16);return[(c>>16)&255,(c>>8)&255,c&255,255]}
function match(a,b){return a[0]==b[0]&&a[1]==b[1]&&a[2]==b[2]}

function enhance(){
 let img=ctx.getImageData(0,0,canvas.width,canvas.height);
 for(let i=0;i<img.data.length;i+=4){
  if(img.data[i]<240) img.data[i]=img.data[i+1]=img.data[i+2]=0;
 }
 ctx.putImageData(img,0,0);
}

function undo(){
 if(!undoStack.length)return;
 let im=new Image();
 im.src=undoStack.pop();
 im.onload=()=>ctx.drawImage(im,0,0);
}

function save(){
 let d=JSON.parse(localStorage.getItem("data_"+currentProfile));
 d.saved.push(canvas.toDataURL());
 localStorage.setItem("data_"+currentProfile,JSON.stringify(d));
 alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
}

function openImage(src){
 show("editor");
 let img=new Image();
 img.src=src;
 img.onload=()=>{
  canvas.width=img.width;
  canvas.height=img.height;
  ctx.drawImage(img,0,0);
 };
}
function openEditor(){
 show("editor");
 canvas.width=800;canvas.height=800;
 ctx.fillStyle="#fff";ctx.fillRect(0,0,800,800);
}
function backHome(){
 if(confirm("Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ø¯ÙˆÙ† Ø­ÙØ¸ØŸ")) show("home");
}

/* START */
loadProfiles();
show("profiles");
</script>
</body>
</html>
