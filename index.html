<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coloring App</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>

<style>
body { margin:0; font-family:Arial; background:#eee; }

#home, #editor { display:none; }

#home {
  padding:10px;
}

.gallery img {
  width:120px;
  margin:6px;
  border:2px solid #ccc;
  cursor:pointer;
  background:white;
}

#editor {
  height:100vh;
  display:flex;
  flex-direction:column;
}

#toolbar {
  background:#fff;
  padding:6px;
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  border-bottom:1px solid #ccc;
}

.palette div {
  width:26px;
  height:26px;
  border-radius:50%;
  border:1px solid #333;
  cursor:pointer;
}

#canvasWrap {
  flex:1;
  background:#999;
}

canvas {
  background:white;
}
</style>
</head>

<body>

<div id="home">
  <h3>اختار صورة</h3>
  <div class="gallery">
    <img src="images/1.png" onclick="openImage(this.src)">
    <img src="images/2.png" onclick="openImage(this.src)">
    <img src="images/3.png" onclick="openImage(this.src)">
  </div>

  <button onclick="openBlank()">لوحة فاضية</button>
</div>

<div id="editor">
  <div id="toolbar">
    <button onclick="setBrush()">فرشة</button>
    <button onclick="setBucket()">بوكت</button>
    <button onclick="backHome()">رجوع</button>

    <div class="palette" style="display:flex;gap:4px;">
      <div style="background:red" onclick="setColor('#ff0000')"></div>
      <div style="background:green" onclick="setColor('#00aa00')"></div>
      <div style="background:blue" onclick="setColor('#0000ff')"></div>
      <div style="background:yellow" onclick="setColor('#ffff00')"></div>
      <div style="background:black" onclick="setColor('#000000')"></div>
      <div style="background:white" onclick="setColor('#ffffff')"></div>
    </div>
  </div>

  <div id="canvasWrap">
    <canvas id="c"></canvas>
  </div>
</div>

<script>
let canvas;
let currentColor = "#ff0000";

document.getElementById("home").style.display = "block";

function initCanvas() {
  const wrap = document.getElementById("canvasWrap");

  canvas = new fabric.Canvas("c", {
    isDrawingMode:true,
    selection:false
  });

  canvas.setWidth(wrap.clientWidth);
  canvas.setHeight(wrap.clientHeight);

  canvas.freeDrawingBrush.width = 6;
  canvas.freeDrawingBrush.color = currentColor;

  canvas.backgroundColor = "white";
  canvas.renderAll();
}

function openImage(src) {
  document.getElementById("home").style.display = "none";
  document.getElementById("editor").style.display = "flex";

  setTimeout(() => {
    initCanvas();
    fabric.Image.fromURL(src, img => {
      img.scaleToWidth(canvas.width);
      canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
    }, { crossOrigin:"anonymous" });
  }, 50);
}

function openBlank() {
  document.getElementById("home").style.display = "none";
  document.getElementById("editor").style.display = "flex";

  setTimeout(() => {
    initCanvas();
  }, 50);
}

function setBrush() {
  canvas.isDrawingMode = true;
}

function setBucket() {
  canvas.isDrawingMode = false;
  canvas.once("mouse:down", opt => {
    const obj = canvas.findTarget(opt.e);
    if (obj) {
      obj.set("fill", currentColor);
      canvas.renderAll();
    }
  });
}

function setColor(c) {
  currentColor = c;
  if (canvas && canvas.freeDrawingBrush) {
    canvas.freeDrawingBrush.color = c;
  }
}

function backHome() {
  canvas.dispose();
  document.getElementById("editor").style.display = "none";
  document.getElementById("home").style.display = "block";
}
</script>

</body>
</html>
