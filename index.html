<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coloring Game</title>

<style>
body {
  margin: 0;
  font-family: Arial;
  background: #f2f2f2;
  overflow: hidden;
}

#topBar {
  display: flex;
  justify-content: center;
  gap: 10px;
  padding: 8px;
  background: #fff;
  border-bottom: 1px solid #ccc;
}

button {
  padding: 6px 10px;
  border: none;
  border-radius: 6px;
  background: #ddd;
  cursor: pointer;
}

button.active {
  background: #4caf50;
  color: #fff;
}

#colors {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 6px;
  padding: 8px;
  background: #fff;
}

.color {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 2px solid #999;
  cursor: pointer;
}

.color.selected {
  border: 4px solid #000;
  transform: scale(1.1);
}

#canvasContainer {
  position: relative;
  width: 100%;
  height: calc(100vh - 160px);
  background: #eee;
}

canvas {
  background: white;
  touch-action: none;
}

#gallery {
  display: flex;
  gap: 10px;
  padding: 10px;
  overflow-x: auto;
  background: #fff;
  border-top: 1px solid #ccc;
}

#gallery img {
  width: 80px;
  border: 2px solid #ccc;
  cursor: pointer;
}
</style>
</head>

<body>

<div id="topBar">
  <button id="brushBtn" class="active">ğŸ–Œï¸</button>
  <button id="bucketBtn">ğŸª£</button>
  <button id="eraserBtn">ğŸ§½</button>
  <button id="undoBtn">â†©ï¸ Undo</button>
  <button id="blankBtn">â¬œ Ù„ÙˆØ­Ø© ÙØ§Ø¶ÙŠØ©</button>
  <button id="saveBtn">ğŸ’¾ Ø­ÙØ¸</button>
</div>

<div id="colors"></div>

<div id="canvasContainer">
  <canvas id="canvas"></canvas>
</div>

<div id="gallery"></div>

<audio id="colorSound" src="sounds/color.mp3"></audio>
<audio id="paintSound" src="sounds/paint.mp3"></audio>
<audio id="finishSound" src="sounds/finish.mp3"></audio>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
resizeCanvas();

let currentTool = "brush";
let currentColor = "#ff0000";
let drawing = false;
let undoStack = [];

const colors = [
  "#000000","#ffffff","#ff0000","#00ff00","#0000ff","#ffff00",
  "#ff00ff","#00ffff","#ff9800","#795548","#9c27b0","#607d8b"
];

const colorsDiv = document.getElementById("colors");
colors.forEach(c=>{
  const d=document.createElement("div");
  d.className="color";
  d.style.background=c;
  d.onclick=()=>{
    document.querySelectorAll(".color").forEach(x=>x.classList.remove("selected"));
    d.classList.add("selected");
    currentColor=c;
    document.getElementById("colorSound").play();
  };
  colorsDiv.appendChild(d);
});
colorsDiv.firstChild.classList.add("selected");

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight - 160;
}

window.addEventListener("resize", resizeCanvas);

function saveState(){
  undoStack.push(canvas.toDataURL());
  if(undoStack.length>20) undoStack.shift();
}

canvas.addEventListener("mousedown", startDraw);
canvas.addEventListener("mousemove", draw);
canvas.addEventListener("mouseup", stopDraw);

canvas.addEventListener("touchstart", e=>{
  startDraw(e.touches[0]);
});
canvas.addEventListener("touchmove", e=>{
  draw(e.touches[0]);
  e.preventDefault();
});
canvas.addEventListener("touchend", stopDraw);

function startDraw(e){
  saveState();
  drawing = true;
  ctx.beginPath();
  ctx.moveTo(e.clientX, e.clientY - 160);
}

function draw(e){
  if(!drawing) return;
  ctx.lineWidth = 12;
  ctx.lineCap = "round";

  if(currentTool==="eraser"){
    ctx.globalCompositeOperation="destination-out";
    ctx.strokeStyle="rgba(0,0,0,1)";
  }else{
    ctx.globalCompositeOperation="source-over";
    ctx.strokeStyle=currentColor;
  }

  ctx.lineTo(e.clientX, e.clientY - 160);
  ctx.stroke();
  document.getElementById("paintSound").play();
}

function stopDraw(){
  drawing=false;
  ctx.closePath();
}

document.getElementById("brushBtn").onclick=()=>setTool("brush");
document.getElementById("eraserBtn").onclick=()=>setTool("eraser");
document.getElementById("bucketBtn").onclick=()=>setTool("bucket");

function setTool(t){
  currentTool=t;
  document.querySelectorAll("#topBar button").forEach(b=>b.classList.remove("active"));
  if(t==="brush") brushBtn.classList.add("active");
  if(t==="eraser") eraserBtn.classList.add("active");
  if(t==="bucket") bucketBtn.classList.add("active");
}

document.getElementById("undoBtn").onclick=()=>{
  if(undoStack.length){
    let img=new Image();
    img.src=undoStack.pop();
    img.onload=()=>ctx.drawImage(img,0,0);
  }
};

document.getElementById("blankBtn").onclick=()=>{
  if(confirm("Ù‡ØªØ¨Ø¯Ø£ Ù„ÙˆØ­Ø© ÙØ§Ø¶ÙŠØ©ØŸ")){
    saveState();
    ctx.clearRect(0,0,canvas.width,canvas.height);
  }
};

document.getElementById("saveBtn").onclick=()=>{
  if(confirm("ØªØ­Ø¨ ØªØ­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©ØŸ")){
    const link=document.createElement("a");
    link.download="colored.png";
    link.href=canvas.toDataURL();
    link.click();
    document.getElementById("finishSound").play();
  }
};

// Gallery
const gallery=document.getElementById("gallery");
["1.png","2.png","3.png"].forEach(n=>{
  const img=document.createElement("img");
  img.src="images/"+n;
  img.onclick=()=>{
    saveState();
    const im=new Image();
    im.src=img.src;
    im.onload=()=>{
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(im,0,0,canvas.width,canvas.height);
    };
  };
  gallery.appendChild(img);
});
</script>

</body>
</html>
